{% extends "base.html" %}

{% block title %}Compras y Gastos - Beer Licorería{% endblock %}

{% block extra_css %}
<style>
    /* Estadísticas cards */
    .stat-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
    }
    
    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    /* Tabla responsive */
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
    }
    
    /* Badges personalizados */
    .badge-tipo {
        padding: 6px 12px;
        font-weight: 500;
    }
    
    .badge-productos {
        background-color: #28a745;
    }
    
    .badge-insumos {
        background-color: #ffc107;
        color: #000;
    }
    
    .badge-gastos {
        background-color: #dc3545;
    }
    
    /* Filtros móviles */
    .filtros-container {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    /* Botón flotante para móvil */
    .btn-flotante {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    /* Lista de compras móvil */
    @media (max-width: 768px) {
        .compra-item {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .compra-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .compra-body {
            color: #6c757d;
            font-size: 14px;
        }
        
        .compra-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }
        
        .table-desktop {
            display: none;
        }
    }
    
    @media (min-width: 769px) {
        .lista-movil {
            display: none;
        }
        
        .btn-flotante {
            display: none;
        }
    }
    
    /* Animaciones */
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Encabezado -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="bi bi-bag-plus"></i> Compras y Gastos</h3>
        <a href="{{ url_for('compra_nueva') }}" class="btn btn-primary d-none d-md-inline-block">
            <i class="bi bi-plus-lg"></i> Nueva Compra
        </a>
    </div>
    
    <!-- Estadísticas -->
    <div class="row mb-4">
        <!-- Total Compras Hoy -->
        <div class="col-6 col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon bg-primary bg-opacity-10 text-primary me-3">
                            <i class="bi bi-calendar-day"></i>
                        </div>
                        <div>
                            <div class="text-muted small">Hoy</div>
                            <h5 class="mb-0">Bs. <span id="totalHoy">0</span></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Total Compras Mes -->
        <div class="col-6 col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon bg-success bg-opacity-10 text-success me-3">
                            <i class="bi bi-calendar-month"></i>
                        </div>
                        <div>
                            <div class="text-muted small">Este Mes</div>
                            <h5 class="mb-0">Bs. <span id="totalMes">0</span></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Total Gastos -->
        <div class="col-6 col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon bg-danger bg-opacity-10 text-danger me-3">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <div>
                            <div class="text-muted small">Gastos</div>
                            <h5 class="mb-0">Bs. <span id="totalGastos">0</span></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Total General -->
        <div class="col-6 col-md-3 mb-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon bg-warning bg-opacity-10 text-warning me-3">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div>
                            <div class="text-muted small">Total</div>
                            <h5 class="mb-0">Bs. <span id="totalGeneral">0</span></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="filtros-container">
        <div class="row">
            <div class="col-md-3 mb-2">
                <label class="form-label">Tipo:</label>
                <select id="filtroTipo" class="form-select">
                    <option value="">Todos</option>
                    <option value="productos">Productos</option>
                    <option value="insumos">Insumos</option>
                    <option value="gastos">Gastos</option>
                </select>
            </div>
            
            <div class="col-md-3 mb-2">
                <label class="form-label">Desde:</label>
                <input type="date" id="filtroDesde" class="form-control">
            </div>
            
            <div class="col-md-3 mb-2">
                <label class="form-label">Hasta:</label>
                <input type="date" id="filtroHasta" class="form-control">
            </div>
            
            <div class="col-md-3 mb-2">
                <label class="form-label">Buscar:</label>
                <div class="input-group">
                    <input type="text" id="filtroBuscar" class="form-control" placeholder="Proveedor, descripción...">
                    <button class="btn btn-outline-secondary" type="button" id="btnBuscar">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="row mt-2">
            <div class="col">
                <button id="btnFiltrar" class="btn btn-primary">
                    <i class="bi bi-funnel"></i> Filtrar
                </button>
                <button id="btnLimpiar" class="btn btn-secondary">
                    <i class="bi bi-arrow-clockwise"></i> Limpiar
                </button>
                <button id="btnExportar" class="btn btn-success float-end">
                    <i class="bi bi-file-earmark-excel"></i> Exportar Excel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Tabla Desktop -->
    <div class="table-responsive table-desktop">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Descripción</th>
                    <th>Proveedor</th>
                    <th>Método Pago</th>
                    <th>Monto</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaCompras">
                <!-- Se llenará con JavaScript -->
            </tbody>
        </table>
    </div>
    
    <!-- Lista Móvil -->
    <div class="lista-movil" id="listaMovil">
        <!-- Se llenará con JavaScript -->
    </div>
    
    <!-- Paginación -->
    <nav aria-label="Paginación">
        <ul class="pagination justify-content-center" id="paginacion">
            <!-- Se llenará con JavaScript -->
        </ul>
    </nav>
</div>

<!-- Botón flotante para móvil -->
<a href="{{ url_for('compra_nueva') }}" class="btn btn-primary btn-flotante">
    <i class="bi bi-plus-lg"></i>
</a>

<!-- Modal Ver Detalle -->
<div class="modal fade" id="modalDetalle" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Detalle de Compra</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="detalleCompra">
                <!-- Se llenará con JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnImprimir">
                    <i class="bi bi-printer"></i> Imprimir
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Eliminar -->
<div class="modal fade" id="modalEliminar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Eliminar Compra</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de eliminar esta compra?</p>
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Atención:</strong> Si es una compra de productos, el stock NO se restaurará.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">
                    <i class="bi bi-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast de notificaciones -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="toastNotificacion" class="toast" role="alert">
        <div class="toast-header">
            <strong class="me-auto">Notificación</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMensaje">
            <!-- Mensaje dinámico -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/compras.js') }}"></script>
{% endblock %}
